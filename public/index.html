<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chatbot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .typing-indicator {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .typing-dot {
      width: 8px;
      height: 8px;
      background-color: #6b7280;
      border-radius: 50%;
      animation: typing 1.4s infinite ease-in-out;
    }
    .typing-dot:nth-child(1) { animation-delay: -0.32s; }
    .typing-dot:nth-child(2) { animation-delay: -0.16s; }
    @keyframes typing {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1); }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center min-h-screen p-4">
  <div class="bg-white rounded-2xl shadow-xl w-full max-w-md flex flex-col h-[600px] border border-gray-200">
    <!-- Header -->
    <header class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-4 rounded-t-2xl text-center font-semibold text-lg flex items-center justify-center">
      <div class="w-6 h-6 mr-2 bg-white rounded-full flex items-center justify-center">
        <div class="w-4 h-4 bg-indigo-600 rounded-full"></div>
      </div>
      Chatbot
    </header>

    <!-- Chat Messages Container -->
    <main id="chat" class="flex-1 p-4 overflow-y-auto space-y-4 bg-gray-50">
      <!-- Welcome message -->
      <div class="max-w-[80%] px-4 py-3 rounded-2xl bg-gray-200 text-gray-900 self-start">
        <p class="text-sm">Hello! I'm your AI assistant powered by Google Gemini. I'm connected to a secure backend server!</p>
      </div>
    </main>

    <!-- Input Form -->
    <form id="chat-form" class="flex border-t border-gray-200 p-4 bg-white rounded-b-2xl">
      <input
        id="user-input"
        type="text"
        placeholder="Type your message here..."
        class="flex-1 border border-gray-300 rounded-l-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200"
        autocomplete="off"
        required
      />
      <button
        type="submit"
        class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-3 rounded-r-xl hover:from-indigo-700 hover:to-purple-700 transition-all duration-200 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
        id="send-button"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
        </svg>
      </button>
    </form>
  </div>

  <script>
    const chat = document.getElementById('chat');
    const form = document.getElementById('chat-form');
    const input = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');

    // Backend API endpoint
    const BACKEND_API_URL = '/api/chat';

    // Function to add a message to the chat window
    function addMessage(text, sender = 'user') {
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('max-w-[80%]', 'px-4', 'py-3', 'rounded-2xl', 'break-words', 'shadow-sm');
      
      if (sender === 'user') {
        messageDiv.classList.add('bg-gradient-to-r', 'from-indigo-600', 'to-purple-600', 'text-white', 'self-end', 'ml-auto');
      } else {
        messageDiv.classList.add('bg-white', 'text-gray-900', 'border', 'border-gray-200', 'self-start');
      }
      
      messageDiv.innerHTML = `<p class="text-sm">${text.replace(/\n/g, '<br>')}</p>`;
      chat.appendChild(messageDiv);
      chat.scrollTop = chat.scrollHeight;
    }

    // Function to show typing indicator
    function showTypingIndicator() {
      const typingDiv = document.createElement('div');
      typingDiv.id = 'typing-indicator';
      typingDiv.classList.add('max-w-[80%]', 'px-4', 'py-3', 'rounded-2xl', 'bg-white', 'border', 'border-gray-200', 'self-start');
      typingDiv.innerHTML = `
        <div class="typing-indicator">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
      `;
      chat.appendChild(typingDiv);
      chat.scrollTop = chat.scrollHeight;
    }

    // Function to hide typing indicator
    function hideTypingIndicator() {
      const typingIndicator = document.getElementById('typing-indicator');
      if (typingIndicator) {
        typingIndicator.remove();
      }
    }

    // Function to send message to backend API
    async function sendMessageToBackend(message) {
      try {
        const response = await fetch(BACKEND_API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ message })
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        return data.reply;
      } catch (error) {
        console.error('Error:', error);
        return `Sorry, I encountered an error: ${error.message}. Please check the server connection.`;
      }
    }

    // Form submission handler
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const userMessage = input.value.trim();
      if (!userMessage) return;

      // Add user message
      addMessage(userMessage, 'user');
      input.value = '';
      input.disabled = true;
      sendButton.disabled = true;

      // Show typing indicator
      showTypingIndicator();

      try {
        // Send message to backend API
        const botReply = await sendMessageToBackend(userMessage);
        
        // Remove typing indicator and add bot response
        hideTypingIndicator();
        addMessage(botReply, 'bot');
      } catch (error) {
        hideTypingIndicator();
        addMessage(`Error: ${error.message}`, 'bot');
      } finally {
        input.disabled = false;
        sendButton.disabled = false;
        input.focus();
      }
    });

    // Auto-focus input on page load
    input.focus();

    // Allow sending with Enter key (but allow Shift+Enter for new lines)
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        form.dispatchEvent(new Event('submit'));
      }
    });
  </script>
</body>
</html>